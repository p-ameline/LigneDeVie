package com.ldv.client.mvp;

import com.google.gwt.dom.client.Style.Position;
import com.google.gwt.event.dom.client.HasClickHandlers;
import com.google.gwt.event.dom.client.HasMouseDownHandlers;
import com.google.gwt.event.dom.client.HasMouseUpHandlers;
import com.google.gwt.user.client.DOM;
import com.google.gwt.user.client.ui.AbsolutePanel;
import com.google.gwt.user.client.ui.Button;
import com.google.gwt.user.client.ui.Composite;
import com.google.gwt.user.client.ui.FocusPanel;
import com.google.gwt.user.client.ui.Label;
import com.google.gwt.user.client.ui.Widget;
import com.google.gwt.widgetideas.client.ResizableWidget;
import com.ldv.client.canvas.LdvScrollArea;
import com.ldv.client.canvas.LdvTimeController;
import com.ldv.shared.model.LdvTime;
import com.ldv.client.util.LdvTimeZoomLevel;
import com.ldv.client.util.LdvTimeZoomLevel.pixUnit;

//public class LdvTimeControlView extends SimplePanel implements ResizableWidget, /*SourcesChangeEvents,*/ LdvTimeControlPresenter.Display 
public class LdvTimeControlledAreaView extends Composite implements ResizableWidget, /*SourcesChangeEvents,*/ LdvTimeControlledAreaPresenter.Display
{	
	private LdvTime          _topRightTime ;
	private LdvTimeZoomLevel _currentZoomLevel ;
	
	/**
	 * The FlowPanel containing the TimeWidget and the composite
	 */
	private final AbsolutePanel _mainPanel ;
	
	/**
	 * The project area
	 */
	LdvProjectWindowView _projectPanel ;
	
	/**
	 * Time controller
	 */
	private final LdvTimeController _ldvTimeController ;
	
	/**
	 * The right scrollbar button.
	 */
	private final Button _rightScrollButton;
	
	/**
	 * The left scrollbar button.
	 */
	private final Button _leftScrollButton;
	
	private final int _scrollAreaWidth ;
	
	public LdvTimeControlledAreaView()
	{	
		super() ;
		
		// _projectPanel = new LdvProjectWindowView() ;
		
		_currentZoomLevel = new LdvTimeZoomLevel(pixUnit.pixMonth, 0, 0, 0) ;
		_topRightTime = new LdvTime(0) ;
		_topRightTime.takeTime() ;
		
		_rightScrollButton = new Button(">") ;
		_rightScrollButton.addStyleName("ldvScrollBarRightButton") ;
		_leftScrollButton = new Button("<") ;
		_leftScrollButton.addStyleName("ldvScrollBarLeftButton") ;
		
		_ldvTimeController = new LdvTimeController(_topRightTime, _currentZoomLevel, _rightScrollButton, _leftScrollButton) ;
		_ldvTimeController.addStyleName("ldvTimeController") ;
			    
		_mainPanel = new AbsolutePanel() ;
		_mainPanel.addStyleName("ldvMainWorkspace") ;
		_mainPanel.getElement().getStyle().setPosition(Position.RELATIVE) ;
		
		_mainPanel.add(_ldvTimeController) ;
		
		_scrollAreaWidth = this.getScrollArea().getOffsetWidth() ;
		
		initWidget(_mainPanel) ;
	}	
	
	@Override
	public Widget asWidget() {
		return this ;
	}

	@Override
	public void startProcessing() {
		
	}

	@Override
	public void stopProcessing() {
		
	}
	
	@Override
	public int getAreaWidth(){
		return _mainPanel.getOffsetWidth() ;		
	}
	
	@Override
	public LdvTimeController getTimeController(){
		return this._ldvTimeController ;
	}
	
	@Override
	public LdvScrollArea getScrollArea(){
		return this.getTimeController().getScrollArea() ;
	}
	
	@Override
	public FocusPanel getThumb(){
		return this.getScrollArea().getThumb() ;
	}
		
	public HasClickHandlers getRightButton() {
		return _rightScrollButton;
	}
	
	public HasClickHandlers getLeftButton() {
		return _leftScrollButton;
	}
	
	public HasMouseDownHandlers getRightButtonMouseDown(){
		return _rightScrollButton;
	}
	
	public HasMouseUpHandlers getRightButtonMouseUp(){
		return _rightScrollButton;
	}
	
	public HasMouseDownHandlers getLeftButtonMouseDown(){
		return _leftScrollButton;
	}
	
	public HasMouseUpHandlers   getLeftButtonMouseUp(){
		return _leftScrollButton;
	}
	
	@Override
	public AbsolutePanel getMainPanel() {
		return _mainPanel ;
	}
	
	@Override
	public LdvTimeZoomLevel getCurrentZoomLevel() {
		return _currentZoomLevel;
	}

	@Override
	public LdvTime getTopRightTime() {
		return _topRightTime;
	}

	@Override
	public void setCurrentZoomLevel(LdvTimeZoomLevel currentZoomLevel) {
		_currentZoomLevel = currentZoomLevel;
	}

	@Override
	public void setTopRightTime(LdvTime topRightTime) {
		_topRightTime = topRightTime;
	}
/*	
	@Override
	public int getScrollAreaWidth(){
		return this._scrollAreaWidth ;
	}
*/	
	@Override
	public void refresh(LdvTime topRightTime, LdvTimeZoomLevel currentZoomLevel)
	{	
		_ldvTimeController.refresh(topRightTime, currentZoomLevel) ;
	}
	
	/**
	 *  return the position from the left side of the screen in pixel.
	 */
	@Override
	public long getInternalPhysicalPosition(LdvTime ldvTime)
	{			
		int elementOffsetLeft = DOM.getElementPropertyInt(_ldvTimeController.getElement(), "offsetLeft");
		return (_ldvTimeController.getInternalPhysicalPosition(ldvTime) + elementOffsetLeft) ;		
	}
	
	@Override
	public void onResize(int width, int height) {
		// TODO Auto-generated method stub		
	}
}
